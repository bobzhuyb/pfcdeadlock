\section{Discussion}

\para{Multiple application classes:} Sometimes, system administrators need to
use multiple lossless priorities to keep different traffic classes from impacting each
other. For example, in~\cite{dcqcn} congestion notification packets were
assigned a separate lossless class from data traffic to ensure that they would
not just be delivered losslessly, but also would not be held up behind data
traffic.

A n{\"a}ive way to use \sysname{} in such cases is to treat each application (or
traffic class) separately.  For example, in \S\ref{subsec:combine}, we showed
that for the Clos network, if we want to make  all paths with no more than $M$
bounces lossless, we need $M+1$ priorities. If there are $N$ applications, the
n{\"a}ive approach would use $N*(M+1)$ priorities.  However, the switches may
not have sufficient buffer to support this large number of lossless queues
(\S\ref{subsec:pfcheadroom}.

However, if we are willing to trade off some isolation, we can proceed as
follows.  We start the first lossless class with tag 1, and uses tag upto $M+1$.
The second lossless class starts with tag 2, and change tags in the same way as
the first class.  That is, whenever it has a bounce, the tag will increase by
one. The second lossless class uses tag from 2 to $M+2$. This goes on until the
$N'th$ lossless class. The total number of tags and lossless classes required is
$M + N -1$. The operator can further reduce the number of tags required by allowing
some application classes to tolerate fewer bounces than others.

We can prove that there is still no deadlock after such mix, by revisiting two
properties described in \S\ref{subsec:specific_deadlock_free}. First, there is
still no deadlock within each tag, because each tag is still a set of
``up-down'' routing. Second, the update of tags is still monotonic. We omit
formal proof for brevity.

The reduced isolation may be acceptable, since only a small fraction of
packets experience one-bounce and may mix with traffic in the next lossless
class.  This technique can be generalized for the output of
Algorithm~\ref{alg:greedy}. 

\para{What to use for tag:} We use DSCP instead of TTL to tag packets. TTL
values are always decremented by the forwarding pipeline in the switch. It's
possible to work around this problem, but using DSCP simplifies the
implementation.

\para{The need to specify expected lossless paths:} The need to specify expected
lossless paths is not a problem in practice. For Clos networks, it is easy to
enumerate paths with any given limit on bouncing. For a general topology, as long
as the routing is traffic agnostic, it is usually easy to determine what routes
the routing algorithm will compute -- e.g. BGP will find shortest AS path etc.
In case an SDN controller is used, the controller algorithm can be used to
generate the paths under a variety of conditions. Even for traffic aware
routing, the operator can run a variety of simulations.

\para{Use of lossy queue:} Some may dislike the fact that we may eventually push
a wayward packet into a lossy queue. We stress that we do this only as a last
resort, and we reiterate that it does not mean that the packets are
automatically or immediately dropped.

\para{Dealing with topology changes:} \sysname{} has to generate a new set of
tags when network topology is updated -- e.g. if a FatTree is expanded by adding
more switches at the spine layer. Under certain conditions (and especially for
Jellyfish-like random topologies), \sysname{} may require a updating tagging
rules in all switches. We are currently studying this problem further. 

\para{Dynamic topologies:} Given the above limitation, it follows that \sysname{}
is not currently suitable for networking architectures that use dynamic
topologies -- e.g. Helios~\cite{helios}, Flyways~\cite{flyways} or
Projector~\cite{projector}. 

\para{PFC alternatives:} One may ask whether getting rid of PFC altogether is a
better way of preventing deadlocks.  We are sympathetic to this view, and are
actively investigating numerous schemes, including minimizing PFC generation
(e.g.  using DCQCN~\cite{dcqcn} or Timely~\cite{timely}, better retransmission
schemes for IB transport layer~\cite{xxx}, as well as other more novel schemes.
For now, we need \sysname{} ensure proper operation of currently deployed RDMA
hardware, which is reliant on PFC, and in which we and others have made
substantial investments.

